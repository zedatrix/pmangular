<div class="uk-section uk-section-default">
    <div class="uk-container">
        <h1 class="uk-h2">Tasks</h1>
        <table class="uk-table uk-table-small uk-table-divider uk-table-hover">
            <thead>
                <tr>
                    <th class="uk-table-shrink uk-text-center">ID #</th>
                    <th class="uk-table-extend">Task</th>
                    <th class="uk-width-small uk-text-center">Status</th>
                    <th class="uk-width-small uk-text-center">Assignee</th>
                    <th class="uk-width-small uk-text-nowrap uk-text-center">Process</th>
                    <!--<th class="uk-width-small uk-text-nowrap uk-text-center">Started</th>-->
                    <th class="uk-width-small uk-text-nowrap uk-text-center">Due</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngIf="!userTasks.length">
                    <td colspan="6" class="uk-text-center">
                        <div class="uk-margin-top" uk-spinner="ratio: 3"></div>
                        <p class="uk-text-center">Loading...</p>
                    </td>
                </tr>
                <tr *ngFor="let task of userTasks" class="uk-table-middle">
                    <td class="uk-text-center">{{ task.id }}</td>
                    <td>{{ task.element_name }}</td>
                    <!--<td class="uk-text-center">{{ task.status }}</td>-->
                    <td class="uk-text-center" style="text-transform:capitalize;">{{ task.advanceStatus }}</td>
                    <td class="uk-text-center">{{ task.process_request.user.firstname }} {{ task.process_request.user.lastname }}</td>
                    <td class="uk-text-center uk-text-small">{{ task.process_request.name }}</td>
                    <!--<td class="uk-text-center uk-text-small">{{ task.initiated_at | date: 'short' }}</td>-->
                    <td class="uk-text-center uk-text-small">{{ task.due_at | date: 'short' }}</td>
                    <td class="uk-text-center uk-text-small">

                        <!-- Start of process modal window to view rendered page-->

                        <button (click)="getUserTask(task.id)" type="button" class="uk-button uk-button-primary uk-button-small" uk-toggle="target: #taskModal">Open</button>

                        <div id="taskModal" class="uk-modal-full" uk-modal>
                            <div class="uk-modal-dialog uk-margin-auto-vertical uk-height-viewport">
                                <button class="uk-modal-close-full uk-close-large" type="button" uk-close></button>
                                <div *ngIf="selectedTask">
                                    <div class="uk-grid-collapse uk-flex-middle" uk-grid>

                                        <div class="uk-width-3-5 ">
                                          <div class="uk-card uk-card-default uk-card-body">
                                            <h5 class="uk-card-title">
                                              {{ selectedTask?.screen.title }}
                                            </h5>
                                            <h5 class="uk-card-title">sasasass
                                              {{ selectedTask?.screen.config[0].name }}
                                            </h5>
                                            <!--<textarea class="uk-textarea" rows="10">{{selectedTask?.screen.config.items.config.content }}</textarea>-->
                                            <textarea class="uk-textarea" rows="10">{{selectedTask?.screen |json }}</textarea>
                                            <textarea class="uk-textarea" rows="20">{{selectedTask.data | json}}</textarea>
                                          </div>
                                        </div>
                                        <div class="uk-width-1-3 uk-background-cover uk-position-relative" style="background:#fff;" uk-height-viewport>
                                            <h4 class="uk-card-title" style="background:#00cd9C;color:#ffffff;text-transform:capitalize;padding-left:20px;">{{ selectedTask?.advanceStatus }}</h4>

                                            <div class="uk-card uk-card-default uk-card-body">

                                                Assigned To
                                                <h5 class="uk-card-subtitle">
                                                  <img src='{{selectedTask?.data._user.avatar}}' width="15%"> {{selectedTask?.data._user.fullname}}
                                                </h5>
                                                <hr>

                                                <h5 class="uk-card-subtitle">Request<br>
                                                  <img src="https://processmaker-ang.s3.us-west-2.amazonaws.com/request1.png" width="12%"> # {{ selectedTask?.process_request_id }}  {{ selectedRequest?.name }} </h5>
                                                <hr>

                                                <h5 class="uk-card-subtitle">Task <br>
                                                  <img src="https://processmaker-ang.s3.us-west-2.amazonaws.com/task1.png" width="12%"> {{ selectedTask?.element_name }}
                                                </h5>
                                                <hr>
                                                Requested By
                                                <h5 class="uk-card-subtitle">
                                                  <img src='{{selectedTask?.requestor.avatar}}' width="15%"> {{selectedTask?.requestor.fullname}}
                                                </h5>

                                            </div>

                                        </div>
                                    </div>
                                    <div *ngIf="!selectedTask" class="uk-position-absolute uk-position-center">
                                        <span uk-spinner="ratio: 4.5"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- End of process modal window to view rendered page-->

                    </td>
                </tr>
            </tbody>
        </table>
        <ul *ngIf="userTasks.length" class="uk-pagination uk-flex-center" uk-margin>
            <li class="pagination-previous">
                <a *ngIf="pagination.currentPage > 1" (click)="getUserTasks(pagination.currentPage - 1)"><span uk-pagination-previous></span></a>
            </li>
            <li *ngFor="let task of userTasks | paginate: pagination; let i = index">
                <a (click)="getUserTasks(pagination.currentPage + i)" [ngClass]="{'uk-disabled': pagination.currentPage === pagination.currentPage + i}">
                    <span>{{ pagination.currentPage + i }}</span>
                </a>
            </li>
            <li class="pagination-next">
                <a *ngIf="pagination.currentPage < pagination.lastPage" (click)="getUserTasks(pagination.currentPage + 1)"><span uk-pagination-next></span></a>
            </li>
        </ul>
    </div>
</div>
